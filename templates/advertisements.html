{% extends "layout.html" %}
{% block title %}åºƒå‘Šæ²è¼‰ - {% endblock %}
{% block content %}
    <h1>ğŸ“¢ åºƒå‘Šæ²è¼‰</h1>
    
    {% if posts %}
        <div class="posts-container">
            {% for post in posts %}
                <div class="post-card" data-post-id="{{ post.id }}" data-store-name="{{ post.store_name }}" data-area="{{ post.area }}" data-price-range="{{ post.price_range }}" data-username="{{ post.username }}" data-school="{{ post.school or '' }}" data-caption="{{ post.caption }}" data-like-count="{{ post.like_count }}">
                    {% if post.image_path %}
                        {% if post.image_path.startswith('https://') %}
                            <img src="{{ post.image_path }}" alt="æŠ•ç¨¿ç”»åƒ" class="post-image">
                        {% else %}
                            <img src="{{ url_for('static', filename=post.image_path) }}" alt="æŠ•ç¨¿ç”»åƒ" class="post-image">
                        {% endif %}
                    {% endif %}
                    <div class="post-content">
                        <h3>{{ post.store_name }}</h3>
                        <div class="post-meta">
                            <span><strong>ğŸ“ åœ°åŸŸ:</strong> {{ post.area }}</span>
                            <span><strong>ğŸ’° ä¾¡æ ¼å¸¯:</strong> {{ post.price_range }}</span>
                            <span><strong>ğŸ‘¤ æŠ•ç¨¿è€…:</strong> {{ post.username }}</span>
                            {% if post.school %}<span><strong>ğŸ« é«˜æ ¡:</strong> {{ post.school }}</span>{% endif %}
                        </div>
                        <div class="post-caption">{{ post.caption }}</div>
                        <div class="post-actions">
                            {% set is_ad_post = (post.user_id == config['ADVERTISER_USER_ID']) or post.google_maps_url %}
                            {% if is_ad_post %}
                              <a class="btn ad-map-clickable" href="{{ url_for('tracking_ad.go', post_id=post.id) }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); return true;">ğŸ—º åœ°å›³ã‚’é–‹ã</a>
                              {% if current_user_id() and not has_used_coupon(post.id, current_user_id()) %}
                                <a class="btn ad-coupon-clickable" href="{{ url_for('tracking_ad.coupon', post_id=post.id) }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); return confirm('æœ¬å½“ã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é–‹ãã¾ã™ã‹ï¼Ÿ\\n\\nã‚¯ãƒ¼ãƒãƒ³ã®åˆ©ç”¨ã¯ä¸€å›ã®ã¿ã§ã€é–‹ã„ãŸå ´åˆäºŒåº¦ã¨é–‹ã‘ã¾ã›ã‚“ï¼');">ğŸŸ ã‚¯ãƒ¼ãƒãƒ³è¡¨ç¤º</a>
                              {% endif %}
                            {% endif %}
                            
                            {% if session.is_admin %}
                                <form method="POST" action="{{ url_for('admin_delete_post', post_id=post.id) }}" 
                                      style="display: inline-block; margin-left: 10px;"
                                      onsubmit="return confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="delete-button">ğŸ—‘ï¸å‰Šé™¤</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“¢</div>
            <p>ç¾åœ¨ã€åºƒå‘Šæ²è¼‰ä¸­ã®æŠ•ç¨¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        </div>
    {% endif %}
{% endblock %}