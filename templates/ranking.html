{% extends "layout.html" %}
{% block title %}ãƒ©ãƒ³ã‚­ãƒ³ã‚° - æ¨ã—ãƒ¡ã‚·{% endblock %}
{% block content %}
    <h1>{{ page_title }} ğŸ†</h1>
    
    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
    <div class="ranking-tabs-container">
        <div class="ranking-tabs">
            <a href="{{ url_for('ranking') }}" 
               class="ranking-tab {% if ranking_type == 'overall' %}active{% endif %}"
               data-type="overall">
                ğŸ† ç·åˆãƒ©ãƒ³ã‚­ãƒ³ã‚°
            </a>
            <a href="{{ url_for('ranking', type='school') }}" 
               class="ranking-tab {% if ranking_type == 'school' %}active{% endif %}"
               data-type="school">
                ğŸ« é«˜æ ¡åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            </a>
        </div>
    </div>

    {% if ranking_type == 'school' %}
        <!-- é«˜æ ¡é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
        <div class="school-selector">
            <form method="GET" class="school-form">
                <input type="hidden" name="type" value="school">
                <div class="form-group">
                    <label for="school">ğŸ« é«˜æ ¡ã‚’é¸æŠ:</label>
                    <select name="school" id="school" class="school-select">
                        <option value="">-- é«˜æ ¡ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                        {% for school_name in schools_with_posts %}
                            <option value="{{ school_name.school }}" {% if school_name.school == selected_school %}selected{% endif %}>
                                {{ school_name.school }} ({{ school_name.post_count }}ä»¶)
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>

        {% if not selected_school %}
            <div class="empty-state">
                <div class="empty-icon">ğŸ«</div>
                <p>ä¸Šè¨˜ã‹ã‚‰é«˜æ ¡ã‚’é¸æŠã—ã¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ âœ¨</p>
            </div>
        {% endif %}
    {% endif %}

    {% if posts %}
        <div class="ranking-info">
            {% if ranking_type == 'school' and selected_school %}
                ğŸ« {{ selected_school }}ã®æŠ•ç¨¿ã‚’ã„ã„ã­æ•°ã®å¤šã„é †ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™
            {% else %}
                ğŸŒŸ å…¨ä½“ã®æŠ•ç¨¿ã‚’ã„ã„ã­æ•°ã®å¤šã„é †ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™
            {% endif %}
        </div>

        <div class="ranking-container">
            {% for post in posts %}
                <div class="ranking-item">
                    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒãƒƒã‚¸ -->
                    {% if loop.index <= 3 %}
                        <div class="ranking-badge rank-{{ loop.index }}">
                            {% if loop.index == 1 %}
                                <span class="medal">ğŸ¥‡</span>
                                <span class="rank-text">1ä½</span>
                            {% elif loop.index == 2 %}
                                <span class="medal">ğŸ¥ˆ</span>
                                <span class="rank-text">2ä½</span>
                            {% elif loop.index == 3 %}
                                <span class="medal">ğŸ¥‰</span>
                                <span class="rank-text">3ä½</span>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="ranking-number">{{ loop.index }}</div>
                    {% endif %}
                    
                    <!-- æŠ•ç¨¿ç”»åƒ -->
                    <div class="post-image-container">
                        {% if post.image_path %}
                            <img src="{{ url_for('static', filename=post.image_path) }}" alt="æŠ•ç¨¿ç”»åƒ" class="post-image">
                        {% else %}
                            <div class="no-image">ğŸ½ï¸</div>
                        {% endif %}
                    </div>
                    
                    <!-- æŠ•ç¨¿æƒ…å ± -->
                    <div class="post-info">
                        <h3 class="store-name">{{ post.store_name }}</h3>
                        <div class="post-meta">
                            <span class="meta-item">ğŸ“ {{ post.area }}</span>
                            <span class="meta-item">ğŸ’° {{ post.price_range }}</span>
                            <span class="meta-item">ğŸ‘¤ {{ post.username }}</span>
                            {% if post.school %}
                                <span class="meta-item">ğŸ« {{ post.school }}</span>
                            {% endif %}
                        </div>
                        <div class="post-caption">{{ post.caption }}</div>
                    </div>
                    
                    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³éƒ¨åˆ† -->
                    <div class="post-actions">
                        <button type="button" class="like-button{% if post.id in liked_posts %} liked{% endif %}" data-post-id="{{ post.id }}">
                            <span class="heart-icon">{% if post.id in liked_posts %}â¤ï¸{% else %}ğŸ¤{% endif %}</span>
                            <span class="like-count">{{ post.like_count }}</span>
                        </button>
                        
                        {% if session.is_admin %}
                            <form method="POST" action="{{ url_for('admin_delete_post', post_id=post.id) }}" 
                                  class="delete-form"
                                  onsubmit="return confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="delete-button">ğŸ—‘ï¸ å‰Šé™¤</button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% elif ranking_type == 'overall' or (ranking_type == 'school' and selected_school) %}
        <div class="empty-state">
            <div class="empty-icon">ğŸŒŸ</div>
            <p>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <a href="{{ url_for('post') }}" class="cta-button">æŠ•ç¨¿ã™ã‚‹</a>
        </div>
    {% endif %}
{% endblock %}
