<!doctype html>
<meta charset="utf-8">
<title>クーポン | {{ post.store_name }}</title>
<style>
  body{font-family: system-ui, -apple-system,"Noto Sans JP",sans-serif; padding:20px}
  .code{font-size:2rem; letter-spacing:.1em; font-weight:700}
  .box{border:1px solid #ddd; padding:16px; border-radius:12px; max-width:520px}
  .muted{color:#666; font-size:.9rem}
  a.btn{display:inline-block; padding:8px 12px; border-radius:10px; border:1px solid #ccc; text-decoration:none; background:#f5f5f5; color:#333}
  a.btn:hover{background:#e5e5e5}
</style>
<h1>{{ post.store_name }} のクーポン</h1>
<div class="box">
  <div>会計時にこのコードを見せてください：</div>
  <div class="code">{{ code }}</div>
  <ul class="muted">
    <li>一人一回まで／他割引と併用不可（店舗裁量）</li>
    <li>有効期限：提示日当日</li>
  </ul>
</div>
<p><button class="btn ad-map-btn" data-url="{{ url_for('tracking_ad.go', post_id=post.id) }}">🗺 店の地図を開く</button></p>
<script>
// クーポンページ用の個別JavaScript（モバイル最適化）
document.addEventListener('DOMContentLoaded', function() {
    function handleMapButton(e) {
        if (e.target.classList.contains('ad-map-btn')) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            
            const url = e.target.getAttribute('data-url');
            if (url) {
                // モバイル用の強制的なリダイレクト
                if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                    // モバイルの場合、直接location.hrefで遷移
                    window.location.href = url;
                } else {
                    // デスクトップの場合、新しいタブで開く
                    window.open(url, '_blank', 'noopener,noreferrer');
                }
            }
        }
    }

    // タッチとクリック両方に対応
    document.addEventListener('click', handleMapButton);
    document.addEventListener('touchend', handleMapButton);
});
</script>